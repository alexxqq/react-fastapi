name: deployReactFastAPI

'on':
  workflow_call: null
  workflow_dispatch: null
  push:
    branches:
      - master
jobs:
  DeployFastAPI:
    name: deploying
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Deploy
        env:
          SSH_KEY: ${{secrets.FASTAPI_KEY_SSH}} 
        run: |

          echo $SSH_KEY | tr ' ' '\n' | base64 --decode > key1.pem
          
          chmod 400 key1.pem
          ssh -o StrictHostKeyChecking=no -i "key1.pem" ubuntu@ec2-13-60-10-27.eu-north-1.compute.amazonaws.com '
          
          cd .ssh
          eval $(ssh-agent -s)
          ssh-add ec2FastAPI
          cd
          cd fastAPI
          cd react-fastapi
          git pull origin master
          cd backend/src
          sudo docker stop FastAPI
          sudo docker rm FastAPI
          sudo docker rmi src-web
          sudo docker compose up -d
        '